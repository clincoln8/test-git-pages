(this["webpackJsonpmcf-browser"]=this["webpackJsonpmcf-browser"]||[]).push([[0],{11:function(e,t,n){e.exports=n(19)},16:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(10),i=n.n(s),c=(n(16),n(4)),l=n(5),o=n(7),u=n(6),d=(n(8),n(1)),f=n.n(d),h=n(2),p=n(3),v="https://api.datacommons.org";function m(e){return v+"/node/property-labels?dcids="+e}function b(e,t,n){var r=v+"/node/property-values?dcids="+e+"&property="+t+"&direction=";return r+=n?"out":"in",r+="&limit=500"}function y(e){return g.apply(this,arguments)}function g(){return(g=Object(p.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m(t),e.abrupt("return",fetch(n).then((function(e){return e.json()})).then((function(e){return JSON.parse(e.payload)[t]})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,n){return E.apply(this,arguments)}function E(){return(E=Object(p.a)(f.a.mark((function e(t,n,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b(t,n,r),e.abrupt("return",fetch(a).then((function(e){return e.json()})).then((function(e){return JSON.parse(e.payload)[t]})).then((function(e){return console.log("url: "+a+", values: "+e),r?e.out:e.in})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){var t;return"dcid"in e?((t=w.getNode(e.dcid,!0)).setDCID(e.dcid),t.existsInKG=!0):"value"in e?t=e.value:console.log("ERROR remote fetch no dcid or value prop: "+e),t}var w=function(){function e(t){Object(c.a)(this,e),this.localID=t,this.alreadyFetched=!1,this.existsInKG=!1,this.dcid=null}return Object(l.a)(e,[{key:"setDCID",value:function(t){var n=e.nodeHash[t];n&&this.mergeNode(n),this.dcid=t,e.dcidToLocal[t]=this.localID,e.nodeHash[t]=this}},{key:"mergeNode",value:function(e){if(this.localID!==e.localID){console.log("called merge");var t,n=e.getAssertions(),r=Object(h.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.src=this,a.nextAssertion=this.assertions,this.assertions=a}}catch(o){r.e(o)}finally{r.f()}var s,i=e.getInvAssertions(),c=Object(h.a)(i);try{for(c.s();!(s=c.n()).done;){var l=s.value;l.target=this,l.nextInvAssertion=this.invAssertions,this.invAssertions=l}}catch(o){c.e(o)}finally{c.f()}}}},{key:"getRef",value:function(){var e="",t="";return this.dcid&&(e=this.dcid),this.dcid&&this.dcid===this.localID||(t="[l:"+this.localID+"]"),e+" "+t}},{key:"setExistsInKG",value:function(){var e=Object(p.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dcid&&!this.existsInKG){e.next=2;break}return e.abrupt("return");case 2:return t=v+"/node/triples?dcids="+this.dcid+"&limit=1",n=this,e.abrupt("return",fetch(t).then((function(e){return e.json()})).then((function(e){JSON.parse(e.payload)[n.dcid]&&(n.existsInKG=!0)})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchRemoteData",value:function(){var e=Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this).alreadyFetched&&t.dcid){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,y(t.dcid).then(function(){var e=Object(p.a)(f.a.mark((function e(n){var r,a,s,i,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(h.a)(n.outLabels),e.prev=1,s=f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.value,e.next=3,k(t.dcid,n,!0).then((function(e){if(e){var r,a=Object(h.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=j(s);O.addAssertion(t,n,i,s.provenanceId)}}catch(c){a.e(c)}finally{a.f()}}else console.log("ERROR: could not find value for node: "+t.dcid+", label: "+n)}));case 3:case"end":return e.stop()}}),e)})),r.s();case 4:if((a=r.n()).done){e.next=8;break}return e.delegateYield(s(),"t0",6);case 6:e.next=4;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),r.e(e.t1);case 13:return e.prev=13,r.f(),e.finish(13);case 16:i=Object(h.a)(n.inLabels),e.prev=17,l=f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.value,e.next=3,k(t.dcid,n,!1).then((function(e){var r,a=Object(h.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=j(s);O.addAssertion(i,n,t,s.provenanceId)}}catch(c){a.e(c)}finally{a.f()}}));case 3:case"end":return e.stop()}}),e)})),i.s();case 20:if((c=i.n()).done){e.next=24;break}return e.delegateYield(l(),"t2",22);case 22:e.next=20;break;case 24:e.next=29;break;case 26:e.prev=26,e.t3=e.catch(17),i.e(e.t3);case 29:return e.prev=29,i.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[1,10,13,16],[17,26,29,32]])})));return function(t){return e.apply(this,arguments)}}());case 5:t.alreadyFetched=!0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssertions",value:function(){for(var e=[],t=this.assertions;t;)e.push(t),t=t.nextAssertion;return e}},{key:"getInvAssertions",value:function(){for(var e=[],t=this.invAssertions;t;)e.push(t),t=t.invNextAssertion;return e}}],[{key:"isNode",value:function(t){return t instanceof e}},{key:"getNode",value:function(t,n){var r;if(r=e.nodeHash[e.dcidToLocal[t]])return r;if(r=e.nodeHash[t])return r;if(n){var a=new e(t);return e.nodeHash[t]=a,a}return null}}]),e}();w.nodeLocalHash={},w.dcidToLocal={},w.nodeHash={};var O=function(){function e(t,n,r,a){Object(c.a)(this,e),this.src=t,this.property=n,this.provenance=a,this.target=r,this.nextAssertion=t.assertions,t.assertions=this,r instanceof Object&&(this.invNextAssertion=r.invAssertions,r.invAssertions=this)}return Object(l.a)(e,null,[{key:"addAssertion",value:function(t,n,r,a){return new e(t,n,r,a)}}]),e}();function x(e){return!e.startsWith("//")&&0!==e.length&&!e.startsWith("#")}var N=["l","schema","dcs","dcid"],L=function(){function e(){Object(c.a)(this,e),this.curNode=null,this.prov=null}return Object(l.a)(e,[{key:"handleNodeValue",value:function(e){1===e.length?(e[0]instanceof Object?(this.curNode=w.getNode(e[0].ref,!0),"l"!==e[0].ns&&this.curNode.setDCID(e[0].ref)):this.curNode=w.getNode(e[0],!0),w.nodeLocalHash[this.curNode.localID]=this.curNode):console.log("Error in declaring node: "+e)}},{key:"createAssertionsFromValues",value:function(e,t){var n,r=Object(h.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,s=void 0;return a instanceof Object?(s=w.getNode(a.ref,!0),"l"!==a.ns&&s.setDCID(a.ref)):s=a,O.addAssertion(this.curNode,e,s,this.prov)}}catch(i){r.e(i)}finally{r.f()}}},{key:"parseLine",value:function(t){if(x(t=t.trim())&&t.includes(":")){var n=t.substring(0,t.indexOf(":")),r=t.substring(t.indexOf(":")+1);if(r){var a=e.parsePropValues(r);switch(n){case"Node":this.handleNodeValue(a);break;case"dcid":this.curNode&&1===a.length&&"string"===typeof a[0]?this.curNode.setDCID(a[0].replace(/"/g,"")):console.log("ERROR dcid prop declared before Node:"+t);break;default:this.createAssertionsFromValues(n,a)}}}}},{key:"parseMCFStr",value:function(e,t){var n=t.split(".");n.pop();var r=n.join(".");this.prov="local: "+r;var a,s=e.split("\n"),i=Object(h.a)(s);try{for(i.s();!(a=i.n()).done;){var c=a.value;this.parseLine(c)}}catch(l){i.e(l)}finally{i.f()}return w.nodeLocalHash}}],[{key:"getPropLabel",value:function(e){return e.split(":").length>=2?e.split(":")[0].trim():(console.log("ERROR Line does not contain colon: "+e),null)}},{key:"parsePropValues",value:function(e){var t,n=[],r=Object(h.a)(e.split(","));try{for(r.s();!(t=r.n()).done;){var a=t.value;if(2===a.split(":").length){var s=a.split(":")[0].trim();if(N.indexOf(s)>=0){n.push({ns:s,ref:a.split(":")[1].trim()});continue}}n.push(a.trim())}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"readFile",value:function(t){var n=new FileReader;return n.readAsText(t),new Promise((function(r,a){n.addEventListener("loadend",(function(a){var s=new e;r(s.parseMCFStr(n.result,t.name))})),n.addEventListener("error",a)}))}}]),e}(),A=n(18);function C(e){return e.includes("->")?e.split("->")[1]:null}function D(e){var t=e.match("E:(.*)->(.*)");return t?t[0]:null}function I(e,t){return e?"l:"+e.replace("->","_").replace("E:","")+"_R"+t:null}function R(e,t,n){var r,a=[],s=Object(h.a)(e.split(","));try{for(s.s();!(r=s.n()).done;){var i=r.value,c=i,l=D(i);if(l){var o=I(l,n);c=c.replace(l,o)}else{var u=C(i);c=c.replace(/C:(.*)->(.*)/,t[u])}a.push(c)}}catch(d){s.e(d)}finally{s.f()}return a.join(",")}function S(e,t,n){var r,a=[],s=Object(h.a)(e.split("\n"));try{for(s.s();!(r=s.n()).done;){var i=r.value;if(i.trim()){if(x(i)){var c=i.split(":")[0],l=R(i.replace(c+":","").trim(),t,n);a.push(c+": "+l)}}else a.push("")}}catch(o){s.e(o)}finally{s.f()}return a.join("\n")}function F(e,t){var n,r=1,a=[],s=Object(h.a)(t);try{for(s.s();!(n=s.n()).done;){var i=n.value;a.push(S(e,i,r)),r+=1}}catch(c){s.e(c)}finally{s.f()}return a.join("\n")}function H(e,t){return G.apply(this,arguments)}function G(){return(G=Object(p.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FileReader).readAsText(n),e.abrupt("return",new Promise((function(e,a){r.addEventListener("loadend",(function(a){A().fromString(r.result).then((function(r){console.log("csvFile: "+n.name);var a=F(t,r);e(a)}))})),r.addEventListener("error",a)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return P.apply(this,arguments)}function P(){return(P=Object(p.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FileReader).readAsText(t),e.abrupt("return",new Promise((function(e,t){n.addEventListener("loadend",(function(t){e(n.result)})),n.addEventListener("error",t)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return U.apply(this,arguments)}function U(){return(U=Object(p.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t).then((function(e){return H(e,n)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=Object(p.a)(f.a.mark((function e(t){var n,r,a,s,i,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=Object(h.a)(t);try{for(s.s();!(i=s.n()).done;)(c=i.value).name.endsWith(".tmcf")?n=c:c.name.endsWith(".mcf")?a=c:r=c}catch(l){s.e(l)}finally{s.f()}if(!a){e.next=4;break}return e.abrupt("return",L.readFile(a).then((function(e){return Object.keys(e)})));case 4:if(!n||!r){e.next=6;break}return e.abrupt("return",T(n,r).then((function(e){return console.log(e),(new L).parseMCFStr(e,n.name)})).then((function(e){return Object.keys(e)})));case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){var n=w.getNode(e,!0);return t&&!n.dcid&&n.setDCID(e),console.log("retrieve"),console.log(n),n}function J(e){return w.isNode(e)}function W(e){return q.apply(this,arguments)}function q(){return(q=Object(p.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!t.existsInKG){e.next=4;break}return e.abrupt("return","clickable-blue");case 4:return e.abrupt("return",t.setExistsInKG().then((function(){return console.log(t),t.existsInKG?"clickable-blue":!t.dcid&&t.localID&&t.localID in w.nodeLocalHash?"clickable-purple":t.dcid||t.localID in w.nodeLocalHash?"clickable-red":"clickable-orange"})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y="#";function _(e){e.includes("dcid:")?window.location.hash=Y+"&dcid="+e.replace("dcid:",""):window.location.hash=Y+"&id="+e}var B=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"handleSearch",value:function(e){13===e.keyCode&&_(e.target.value)}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("input",{className:"flex",type:"search",onKeyUp:this.handleSearch,placeholder:"Search id, use 'dcid:' namespace for remote lookup..."}),a.a.createElement("button",{className:"flex",onClick:function(){return console.log(Y),void(window.location.hash=Y)}},"Return Home"))}}]),n}(r.Component);function X(e){return z.apply(this,arguments)}function z(){return(z=Object(p.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!J(t)){e.next=5;break}return e.next=3,W(t);case 3:return n=e.sent,e.abrupt("return",a.a.createElement("td",{className:n,onClick:function(){return _(t.localID)}},t.getRef()));case 5:return e.abrupt("return",a.a.createElement("td",null,t));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(p.a)(f.a.mark((function e(t,n,r){var s,i,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n?t.src:t.target,e.next=3,X(s);case 3:return i=e.sent,c=t.provenance.startsWith("local:")?"bold":null,e.abrupt("return",a.a.createElement("tr",{className:c,key:t.property+r},n?i:null,a.a.createElement("td",null,t.property),n?null:i,a.a.createElement("td",null,t.provenance.replace("local:",""))));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return($=Object(p.a)(f.a.mark((function e(t,n){var r,a,s,i,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=0,s=Object(h.a)(t),e.prev=3,s.s();case 5:if((i=s.n()).done){e.next=14;break}return c=i.value,e.next=9,Q(c,n,a);case 9:l=e.sent,r.push(l),a+=1;case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),s.e(e.t0);case 19:return e.prev=19,s.f(),e.finish(19);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,null,[[3,16,19,22]])})))).apply(this,arguments)}var ee=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={tableRows:null,loading:!0},r}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this;e.triples!==this.props.triples&&(this.setState({loading:!0}),function(e,t){return $.apply(this,arguments)}(this.props.triples,this.props.inverse).then((function(e){t.setState({tableRows:e,loading:!1})})))}},{key:"render",value:function(){if(this.state.loading)return null;var e=this.props.inverse?a.a.createElement("tr",null,a.a.createElement("th",null,"source"),a.a.createElement("th",null,"property"),a.a.createElement("th",null,"provenance")):a.a.createElement("tr",null,a.a.createElement("th",null,"property"),a.a.createElement("th",null,"target"),a.a.createElement("th",null,"provenance"));return a.a.createElement("table",null,a.a.createElement("thead",null,e),a.a.createElement("tbody",null,this.state.tableRows))}}]),n}(r.Component),te=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={ref:null,asserts:[],invAsserts:[],fetching:!0},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.setNodeData()}},{key:"componentDidUpdate",value:function(e){e.node!==this.props.node&&this.setNodeData()}},{key:"setNodeData",value:function(){var e=this;console.log(this.props.node);var t=this.props.node;this.setState({ref:t.getRef(),fetching:!0}),W(t).then((function(t){return e.setState({className:t})})),t.fetchRemoteData().then((function(){e.setState({fetching:!1});var n=t.getAssertions();e.setState({asserts:n});var r=t.getInvAssertions();e.setState({invAsserts:r})}))}},{key:"render",value:function(){var e;return e=this.state.fetching?a.a.createElement("div",null,a.a.createElement("br",null),a.a.createElement("h1",{className:"normal"},"...fetching triples...")):a.a.createElement("div",null,a.a.createElement("h3",null,"Assertions"),a.a.createElement("p",null,a.a.createElement("u",null,"source: ",this.state.ref)),a.a.createElement(ee,{triples:this.state.asserts,inverse:!1}),a.a.createElement("br",null),a.a.createElement("h3",null,"Inverse Assertions"),a.a.createElement("p",null,a.a.createElement("u",null,"target: ",this.state.ref)),a.a.createElement(ee,{triples:this.state.invAsserts,inverse:!0})),a.a.createElement("div",null,a.a.createElement(B,null),a.a.createElement("h1",{className:this.state.className},"Currently Viewing: ",this.state.ref),e,a.a.createElement("br",null),a.a.createElement("p",{className:"clickable-blue"},"Node has dcid and dcid exists in KG"),a.a.createElement("p",{className:"clickable-purple"},"Node has resolved local reference and no dcid"),a.a.createElement("p",{className:"clickable-orange"},"Node has no dcid and local reference is unresolved"),a.a.createElement("p",{className:"clickable-red"},"Anything else (has dcid, but does not exist in KG)"))}}]),n}(r.Component),ne=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={subjNodes:[],curNode:null,fileList:[],loading:null,fileHash:"",firstLoad:!0},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("hashchange",(function(){return e.handleHashChange()}),!1),this.state.firstLoad&&(console.log("first app load"),this.loadUrlFiles(),this.setState({firstLoad:!1}))}},{key:"loadUrlFiles",value:function(){var e=new URLSearchParams(window.location.hash.split("#")[1]),t=e.getAll("file");if(t.length){var n;this.getRemoteFile(0,t),function(e){Y="#";var t,n=Object(h.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;Y+="&file="+r}}catch(a){n.e(a)}finally{n.f()}}(t);var r=e.get("dcid");r&&(n=V(r,!0),this.setState({curNode:n}),console.log(n))}}},{key:"handleHashChange",value:function(){var e=new URLSearchParams(window.location.hash.split("#")[1]),t=e.get("id"),n=!1;t||(t=e.get("dcid"),n=!0);var r=null;t&&(r=V(t,n)),this.setState({curNode:r})}},{key:"getRemoteFile",value:function(e,t){var n=this;if(e>=t.length)this.submitFileList();else{var r=new XMLHttpRequest;r.responseType="blob",r.open("GET",t[e]),console.log("loading: "+t[e]),r.onload=function(){console.log("finished loading"),console.log(r.response);var a=new URL(t[e]);r.response.name=a.pathname,n.setState({fileList:n.state.fileList.concat(r.response)}),n.getRemoteFile(e+1,t)},r.send()}}},{key:"submitFileList",value:function(){var e=this;this.setState({loading:a.a.createElement("h1",null,"...loading mcf...")}),function(e){return M.apply(this,arguments)}(this.state.fileList).then((function(t){e.setState({subjNodes:t,loading:null}),e.handleHashChange()}))}},{key:"onClearPress",value:function(){this.setState({subjNodes:[],fileList:[],loading:null}),w.nodeHash={},w.nodeLocalHash={},w.dcidToLocal={}}},{key:"render",value:function(){var e=this;return this.state.curNode?a.a.createElement(te,{node:this.state.curNode}):a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement(B,null),a.a.createElement("div",{className:"div-col"},a.a.createElement("h3",null,"Upload one MCF file or one set of TMCF+CSV files to preview in Data Commons."),a.a.createElement("div",null,a.a.createElement("input",{id:"file-select",onChange:function(t){e.setState({fileList:e.state.fileList.concat(Array.from(t.target.files))})},type:"file",name:"UploadFile",accept:".mcf,.tmcf,.csv",required:!0,multiple:!0}),a.a.createElement("button",{onClick:function(){return e.submitFileList()}},"Submit")),a.a.createElement("br",null),a.a.createElement("h3",null,"Current Files:"),a.a.createElement("ul",null,this.state.fileList.map((function(e){return a.a.createElement("li",{key:e.name},e.name)}))),a.a.createElement("br",null),a.a.createElement("button",{onClick:function(){return e.onClearPress()}},"Clear"),a.a.createElement("h3",null,"Subject Nodes:"),a.a.createElement("ul",null,this.state.subjNodes.map((function(e){return a.a.createElement("li",{key:e,onClick:function(){return _(e)}},e)}))),this.state.loading)))}}]),n}(r.Component);i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(ne,null)),document.getElementById("root"))},8:function(e,t,n){}},[[11,1,2]]]);
//# sourceMappingURL=main.6bb3b42d.chunk.js.map