(this["webpackJsonpreact-browser"]=this["webpackJsonpreact-browser"]||[]).push([[0],{12:function(e,t,n){e.exports=n(20)},17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(11),l=n.n(o),c=(n(17),n(1)),i=n(2),s=n(6),u=n(5),d=(n(9),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleSearch=function(e){13===e.keyCode&&(window.location.hash="#dcid="+e.target.value)},e}return Object(i.a)(n,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("input",{type:"search",onKeyUp:this.handleSearch,placeholder:"Search for a dcid..."}),a.a.createElement("button",{onClick:function(){return window.location.hash=""}},"Return Home"))}}]),n}(r.Component)),f=n(3),v=n(7),p=n(4),h=n.n(p),m=n(8),b="https://api.datacommons.org",y=function(){function e(t){Object(c.a)(this,e),this.dcid=t,this.alreadyFetched=!1}return Object(i.a)(e,[{key:"fetchRemoteData",value:function(){var e=Object(m.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this).alreadyFetched){e.next=5;break}return e.next=4,E(t.dcid).then(function(){var e=Object(m.a)(h.a.mark((function e(n){var r,a,o,l,c,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(f.a)(n.outLabels),e.prev=1,o=h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.value,e.next=3,j(t.dcid,n,!0).then((function(e){if(e){var r,a=Object(f.a)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;C.createAssertionFromValueObj(t,n,o)}}catch(l){a.e(l)}finally{a.f()}}else console.log("ERROR: could not find value for node: "+t.dcid+", label: "+n)}));case 3:case"end":return e.stop()}}),e)})),r.s();case 4:if((a=r.n()).done){e.next=8;break}return e.delegateYield(o(),"t0",6);case 6:e.next=4;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),r.e(e.t1);case 13:return e.prev=13,r.f(),e.finish(13);case 16:l=Object(f.a)(n.inLabels),e.prev=17,i=h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.value,e.next=3,j(t.dcid,n,!1).then((function(e){var r,a=Object(f.a)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;C.createInvAssertionFromValueObj(t,n,o)}}catch(l){a.e(l)}finally{a.f()}}));case 3:case"end":return e.stop()}}),e)})),l.s();case 20:if((c=l.n()).done){e.next=24;break}return e.delegateYield(i(),"t2",22);case 22:e.next=20;break;case 24:e.next=29;break;case 26:e.prev=26,e.t3=e.catch(17),l.e(e.t3);case 29:return e.prev=29,l.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[1,10,13,16],[17,26,29,32]])})));return function(t){return e.apply(this,arguments)}}());case 4:t.alreadyFetched=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"getNode",value:function(t,n){var r=e.nodeHash[t];if(r)return r;if(n){var a=new e(t);return e.nodeHash[t]=a,a}return null}},{key:"isNode",value:function(t){return t instanceof e}}]),e}();function E(e){var t=function(e){return b+"/node/property-labels?dcids="+e}(e);return fetch(t).then((function(e){return e.json()})).then((function(t){return JSON.parse(t.payload)[e]}))}function j(e,t,n){var r=function(e,t,n){var r=b+"/node/property-values?dcids="+e+"&property="+t+"&direction=";return r+=n?"out":"in",r+="&limit=500"}(e,t,n);return fetch(r).then((function(e){return e.json()})).then((function(t){return JSON.parse(t.payload)[e]})).then((function(e){return console.log("url: "+r+", values: "+e),n?e.out:e.in}))}y.nodeHash={},y.subjNodes={};var D=y,C=function(){function e(t,n,r,a){Object(c.a)(this,e),this.src=t,this.property=n,this.provenance=a,this.target=r,this.nextAssertion=t.assertions,t.assertions=this,r instanceof Object&&(this.invNextAssertion=r.invAssertions,r.invAssertions=this)}return Object(i.a)(e,null,[{key:"addAssertion",value:function(t,n,r,a){new e(t,n,r,a)}},{key:"createAssertionFromValueObj",value:function(t,n,r){var a;"dcid"in r?a=D.getNode(r.dcid,!0):"value"in r?a=r.value:console.log("ERROR Node has no 'dcid' or 'value' prop: "+r),e.addAssertion(t,n,a,r.provenanceId)}},{key:"createInvAssertionFromValueObj",value:function(t,n,r){var a;"dcid"in r?a=D.getNode(r.dcid,!0):console.log("ERROR  Node has no 'dcid' for inverse: "+r),e.addAssertion(a,n,t,r.provenanceId)}}]),e}(),g=["l","schema","dcs","dcid"],O=function(){function e(t){Object(c.a)(this,e),this.curNode=null,this.prov=t}return Object(i.a)(e,[{key:"parseLine",value:function(t){var n=this;if(t=t.trim(),e.shouldReadLine(t)){var r=e.getPropLabel(t);if(r){var a=t.replace(r+":","").trim();if("Node"===r)return this.curNode=e.getNodeFromPropValue(a),void(D.subjNodes[this.curNode.dcid]=this.curNode);var o=e.parsePropValues(a);o&&o.forEach((function(e){return C.addAssertion(n.curNode,r,e,n.prov)}))}}}}],[{key:"readFile",value:function(t){var n=new FileReader;return n.readAsText(t),new Promise((function(r,a){n.addEventListener("loadend",(function(a){r(e.parseMCFStr(n.result,t.name))})),n.addEventListener("error",a)}))}},{key:"parseMCFStr",value:function(t,n){var r,a=t.split("\n"),o=new e("local: "+n),l=Object(f.a)(a);try{for(l.s();!(r=l.n()).done;){var c=r.value;o.parseLine(c)}}catch(i){l.e(i)}finally{l.f()}return D.subjNodes}},{key:"shouldReadLine",value:function(e){return!e.startsWith("#")&&!e.startsWith("//")&&0!==e.length}},{key:"getPropLabel",value:function(e){var t,n=e.split(":");return n.length<2?(console.log("ERROR Line does not contain colon: "+e),t):t=n[0]}},{key:"getNodeFromPropValue",value:function(t){var n=e.getDCIDFromPropValue(t);return n?D.getNode(n,!0):(console.log("ERROR <getNodeFromPropValue> : "+t),null)}},{key:"parsePropValues",value:function(t){if(!t)return null;var n,r=[],a=Object(f.a)(t.split(","));try{for(a.s();!(n=a.n()).done;){var o=n.value;if(2===o.split(":").length){var l=o.split(":")[0].trim();g.indexOf(l)>=0?r.push(e.getNodeFromPropValue(o)):console.log("ERROR <parsePropValues> unregonized namespace: "+t)}else if(1===o.split(":").length){var c=o.split(":")[0].trim();c?r.push(c):console.log("WARNING <parsePropValues> empty value: "+t)}else console.log("ERROR <parsePropValues> too many colons: "+t)}}catch(i){a.e(i)}finally{a.f()}return r}},{key:"getDCIDFromPropValue",value:function(e){if(2===e.split(":").length){var t=e.split(":")[0].trim();if(g.indexOf(t)>=0)return e.split(":")[1].trim()}return console.log("ERROR <getDCID>: "+e),null}}]),e}(),k=n(19),w=function(){function e(){Object(c.a)(this,e),this.localID=void 0}return Object(i.a)(e,[{key:"loadLocalToDCID",value:function(t){var n,r=t.split("\n"),a=Object(f.a)(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o=o.trim(),e.shouldReadLine(o)){var l=e.getPropLabel(o);if(!l)return;var c=o.replace(l+":","").trim();"Node"===l?(this.localID&&!e.localIDToDCID[this.localID]&&(e.localIDToDCID[this.localID]="C:local->index"),this.localID=e.getEntityLocalID(c)):"dcid"===l&&(e.localIDToDCID[this.localID]="dcid:"+c)}}}catch(i){a.e(i)}finally{a.f()}return this.localID&&!e.localIDToDCID[this.localID]&&(e.localIDToDCID[this.localID]="C:local->index"),e.localIDToDCID}}],[{key:"shouldReadLine",value:function(e){return!(e.startsWith("#")||e.startsWith("//")||!e)}},{key:"getPropLabel",value:function(e){var t=e.split(":");if(t.length>1)return t[0];console.log("ERROR Line does not contain colon: "+e)}},{key:"getArrowId",value:function(e){if(e.includes("->"))return e.split("->")[1]}},{key:"getDataSetName",value:function(e){var t=e.match(/(?<=E:)(.*)(?=->)/g);return t?t[0]:"ERROR"}},{key:"getEntityLocalID",value:function(e){var t,n=e.match("E:(.*)->(.*)");return n&&(t=n[0]),t}},{key:"getDCIDFromEntity",value:function(t,n){var r=e.getArrowId(t);return"dcid:"+e.getDataSetName(t)+"_"+r+"_"+n}},{key:"fillTemplateFromRow",value:function(t,n,r){var a,o=[],l=Object(f.a)(t.split("\n"));try{for(l.s();!(a=l.n()).done;){var c=a.value;if(c.trim()){var i=e.getPropLabel(c);if("dcid"!==i){var s,u=c.replace(i+":","").trim(),d=[],v=Object(f.a)(u.split(","));try{for(v.s();!(s=v.n()).done;){var p=s.value,h=e.getEntityLocalID(p),m=p.replace(h,e.localIDToDCID[h]),b=e.getArrowId(m);"index"===b&&(n.index=e.getDCIDFromEntity(h,r)),d.push(m.replace(/C:(.*)->(.*)/,n[b]))}}catch(y){v.e(y)}finally{v.f()}d.length&&o.push(i+": "+d.join(","))}}else o.push("")}}catch(y){l.e(y)}finally{l.f()}return o.join("\n")}},{key:"csvToMCF",value:function(t,n){var r,a=1,o=[],l=Object(f.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value;o.push(e.fillTemplateFromRow(t,c,a)),a+=1}}catch(i){l.e(i)}finally{l.f()}return o.join("\n")}},{key:"readTMCFFile",value:function(t){var n=new FileReader;return n.readAsText(t),new Promise((function(t,r){n.addEventListener("loadend",(function(r){(new e).loadLocalToDCID(n.result),t(n.result)})),n.addEventListener("error",r)}))}},{key:"readCSVFile",value:function(t,n){var r=new FileReader;return r.readAsText(n),new Promise((function(n,a){r.addEventListener("loadend",(function(a){k().fromString(r.result).then((function(r){var a=e.csvToMCF(t,r);n(a)}))})),r.addEventListener("error",a)}))}},{key:"tmcfCSVToMCF",value:function(){var t=Object(m.a)(h.a.mark((function t(n,r){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.readTMCFFile(n).then((function(t){return e.readCSVFile(t,r)})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();w.localIDToDCID={};var F=w,I=function(){function e(){Object(c.a)(this,e)}return Object(i.a)(e,null,[{key:"readTMCF",value:function(e,t){return F.tmcfCSVToMCF(e,t).then((function(t){return console.log(t),O.parseMCFStr(t,e.name)}))}},{key:"readMCF",value:function(e){return O.readFile(e)}},{key:"clearFiles",value:function(){D.nodeHash={},D.subjNodes={},F.localIDToDCID={}}},{key:"retrieveNode",value:function(e){return D.getNode(e,!0)}},{key:"isNodeObj",value:function(e){return D.isNode(e)}}]),e}(),N=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onSubmitMCF=function(){var e=Object(v.a)(r);I.readMCF(r.state.fileList[0]).then((function(t){e.props.setSubjNodes(Object.keys(t))}))},r.onSubmitTMCF=function(){var e,t,n,a=Object(f.a)(r.state.fileList);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.name.endsWith(".tmcf")?e=o:t=o}}catch(c){a.e(c)}finally{a.f()}var l=Object(v.a)(r);I.readTMCF(e,t).then((function(e){l.props.setSubjNodes(Object.keys(e))}))},r.onClearPress=function(){Object(v.a)(r).props.setSubjNodes([]),I.clearFiles()},r.render=function(){return a.a.createElement("div",null,a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement(d,null),a.a.createElement("div",{className:"div-row"},a.a.createElement("div",{className:"div-col"},a.a.createElement("h3",null,"Upload an MCF file to preview in Data Commons."),a.a.createElement("input",{id:"file-select",onChange:function(e){return r.setState({fileList:e.target.files})},type:"file",name:"UploadFile",accept:".mcf",required:!0}),a.a.createElement("br",null),a.a.createElement("button",{id:"submitMCFFile",onClick:r.onSubmitMCF},"Submit"),a.a.createElement("br",null),a.a.createElement("button",{id:"clearFile",onClick:r.onClearPress},"Clear")),a.a.createElement("div",{className:"div-col"},a.a.createElement("h3",null,"Upload TMCF + CSV to preview in Data Commons."),a.a.createElement("input",{id:"file-select",onChange:function(e){return r.setState({fileList:e.target.files})},type:"file",name:"UploadFile",accept:".tmcf,.csv",required:!0,multiple:!0}),a.a.createElement("br",null),a.a.createElement("button",{id:"submitTMCFFile",onClick:r.onSubmitTMCF},"Submit"),a.a.createElement("br",null),a.a.createElement("button",{id:"clearFile",onClick:r.onClearPress},"Clear"))),a.a.createElement("ul",null,r.state.localDCIDList.map((function(e){return a.a.createElement("li",{key:e,onClick:function(){return window.location.hash="#dcid="+e}},e)}))))))},r.state={localDCIDList:r.props.subjNodes,fileList:null},r}return n}(r.Component);function R(e){return I.isNodeObj(e)?a.a.createElement("td",{className:"clickable",onClick:function(){return window.location.hash="#dcid="+e.dcid}},e.dcid):a.a.createElement("td",null,e)}var S=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).render=function(){return a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"property"),a.a.createElement("th",null,"target"),a.a.createElement("th",null,"provenance"))),a.a.createElement("tbody",null,e.props.asserts.map((function(e,t){return a.a.createElement("tr",{key:e.property+t},a.a.createElement("td",null,e.property),R(e.target),a.a.createElement("td",null,e.provenance))}))))},e}return n}(r.Component),L=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).render=function(){return a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"source"),a.a.createElement("th",null,"property"),a.a.createElement("th",null,"provenance"))),a.a.createElement("tbody",null,e.props.invAsserts.map((function(e,t){return a.a.createElement("tr",{key:e.property+t},R(e.src),a.a.createElement("td",null,e.property),a.a.createElement("td",null,e.provenance))}))))},e}return n}(r.Component),A=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).render=function(){return a.a.createElement("div",null,a.a.createElement(d,null),a.a.createElement("h1",null,"Display node: ",r.state.dcid),a.a.createElement("h3",null,"Assertions"),a.a.createElement("p",null,a.a.createElement("u",null,"source: ",r.state.dcid)),a.a.createElement(S,{asserts:r.state.asserts}),a.a.createElement("br",null),a.a.createElement("h3",null,"Inverse Assertions"),a.a.createElement("p",null,a.a.createElement("u",null,"target: ",r.state.dcid)),a.a.createElement(L,{invAsserts:r.state.invAsserts}))},r.state={dcid:r.props.dcid,asserts:[],invAsserts:[]},console.log("render "+r.props.dcid),r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=I.retrieveNode(this.state.dcid);t.fetchRemoteData(t).then((function(){for(var n=t.assertions,r=[],a=[];n;)r.push(n),n=n.nextAssertion;for(var o=t.invAssertions;o;)a.push(o),o=o.invNextAssertion;e.setState({asserts:r,invAsserts:a})}))}}]),n}(r.Component),x=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).setSubjNodes=function(e){r.setState({subjNodes:e})},r.render=function(){return window.location.href.includes("dcid")?r.state.curDCID?a.a.createElement(A,{key:r.state.curDCID,dcid:r.state.curDCID}):a.a.createElement("div",null,a.a.createElement(d,null),a.a.createElement("h2",null,"Requested url could not be found")):a.a.createElement(N,{setSubjNodes:r.setSubjNodes,key:r.state.subjNodes,subjNodes:r.state.subjNodes})},r.state={subjNodes:[],curDCID:null},r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("hashchange",(function(){console.log("in listener"+window.location.hash);var t=new URLSearchParams(window.location.hash.split("#")[1]).get("dcid");t?e.setState({curDCID:t}):e.setState({curDCID:null})}),!1)}}]),n}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));console.log("render from index.js"),l.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(x,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},9:function(e,t,n){}},[[12,1,2]]]);
//# sourceMappingURL=main.d45cc640.chunk.js.map